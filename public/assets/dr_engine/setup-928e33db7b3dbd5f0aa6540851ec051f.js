function setupFieldHint(e){$(e).focus(function(){showFieldHint(this)}).mouseover(function(){showFieldHint(this)}).blur(function(){$(this).prev().prop("class","field-hint-inactive")}).mouseout(function(){$(this).prev().prop("class","field-hint-inactive")})}function checkKeyInfo(){var e=$("#key option:selected");return update_key_desc(e.text(),e.val(),"#key_desc"),!0}function setupDrFlash(){setupFlash(!0,"Validating Data...","Uploading Log File"),window.scrollTo(0,0)}function showHideDiv(e){var t=e.next();"none"==t.css("display")?(t.slideDown(),e.prop("class","sprite-minus")):(t.slideUp(),e.prop("class","sprite-plus")),toggle_disable($("#store"))}function delete_session(){var e=confirm("Are you sure you would like to delete this session?");e&&document.form_name.submit()}function toggle_disable(e){var t="true";if(e.prop("checked")||(t="false"),"true"==t)$("[name^=store_params]").prop("disabled",null).addClass("required");else{$("#store_params_batch_date").next()&&$("#store_params_batch_date").next().hasClass("validation-advice")&&$("#store_params_batch_date").next().remove(),$("[name^=store_params]").prop("disabled","disabled").removeClass("required");for(var i=$("[name^=store_params]"),a=0;a<i.length;a++)$(i[a]).next()&&$(i[a]).next().hasClass("validation-advice")&&$(i[a]).next().remove()}}function update_key_desc(e,t,i){var a="";"custom"==t?(modifyExtraFields(1),e="",a="Custom Key File &#8658; Your key file must be in comma-separated values (csv) or tab-delimited format."):"none"==t?(modifyExtraFields(2),e="",a="Please fill in the density and replicate parameters below.<br/>YOU MAY NOT NORMALIZE DATA TO CONTROLS WITH THIS OPTION SELECTED!"):(modifyExtraFields(0),"R384"==t||"C384"==t?a=" &#8658; Density: 384.  Replicates: 4. Library Mating Type: MAT alpha.":"R384a"==t?a=" &#8658; Density: 384.  Replicates: 4. Library Mating Type: MAT a.":"1536a"==t?a=" &#8658; Density: 1536.  Replicates: 4. Library Mating Type: MAT a.":"R1536"==t?a=" &#8658; Density: 1536.  Replicates: 4. Library Mating Type: MAT alpha.":"DAmPa"==t?a=" &#8658; Density: 1536.  Replicates: 4. Library Mating Type: MAT a.":"DPI"==t?a="&#8658; Density: 1536. Replicates 16. Library Mating Type: MAT alpha.":"RHB_1rep"==t?a=" &#8658; Density: 384.  Replicates: 1. Library Mating Type: MAT alpha.":"R96_1rep"==t?a=" &#8658; Density: 96.  Replicates: 1. Library Mating Type: MAT alpha.":"R96a_1rep"==t?a=" &#8658; Density: 96.  Replicates: 1. Library Mating Type: MAT a.":"hieterMATa"==t?a=" &#8658; Density: 1536.  Replicates: 1. Library Mating Type: MAT a.":"R1536ts_a"==t&&(a=" &#8658; Density: 1536.  Replicates: 4. Library Mating Type: MAT a.")),t&&""!=t?$(i).html(e+a):$(i).html("You must select a key file!"),checkNormalizationMethod(t)}function checkNormalizationMethod(e){var t=$("input:radio[name='normalizationMethod']:checked").val();"none"==e?($("#nToControls").prop("disabled","disabled"),$("#controlNormalLabel").addClass("inactive"),"controls"==t&&$("#nToControls, #doNotNormalize").prop("checked",!1)):($("#nToControls").prop("disabled",null),$("#controlNormalLabel").removeClass("inactive"))}function modifyExtraFields(e){if(e>0){$("#extraKeyInfo").length>0&&$("#extraKeyInfo").remove();var t='<div id="extraKeyInfo" style="display:none;">',i="</div>";t+='<hr style="color:#aaaaaa; padding-bottom:3px; background-color:#aaaaaa;" />',t+='<table class="formTable" style="padding-top:3px;padding-bottom:3px;">',i+="</table>",t+="<tr><td>",t+='<div class="required"><label for="density" class="right required">Screen Plate Density: </label></div></td>',t+="<td>",t+='<div class="field-hint-inactive" id="density-H">',t+="<div>Select the density screened in.<br/>This should be the number of data on each plate.</div></div>",t+='<select id="density" class="formSelect fieldHint" name="density" style="background-color:#ffff99; width:120px;">',t+='<option value="96">96</option>',t+='<option value="384">384</option>',t+='<option value="1536" selected="selected">1536</option>',t+='<option value="2304">2304</option>',t+="</select>";var a='<td><div class="required"><label for="replicates" id="repLabel" class="right required"># of Replicates: </label></div></td>';a+='<td><div class="field-hint-inactive" id="replicates-H">',a+="<div>Select the number of replicates of each element on a plate.</div></div>",a+='<select id="replicates" class="formSelect fieldHint" name="replicates" style="background-color:#ffff99; width:125px;">',a+='<option value="1">1</option>',a+='<option value="2v">2 Vertical</option>',a+='<option value="2h">2 Horizontal</option>',a+='<option value="4" selected="selected">4 square ( 2 x 2 )</option>',a+='<option value="16">16 square ( 4 x 4 )</option>',a+="</select></td>",1==e?(t+='<td rowspan="4"><div class="permanent_notice" style="margin-left:20px;">',t+="Key files uploaded must be in a specific format.<br>Consult the following link for guidance:",t+='<br><br><ul style="margin:0px;"><li><a class="ext_link" onclick="return popup(this, \'Key File Notes\')" href="/tools/screen_mill/key_file_info">',t+="Key file format description and sample.</a></li></ul><br></div></td></tr>",t+="<tr>"+a+"</tr>",t+='<tr><td><div class="required"><label for="id" class="right">ID Column: </label></div></td>',t+='<td><input id="id_col" value="ORF" name="id_col" type="text" class="required field_associates"',t+=' style="background-color:#ffff99;width:125px;"></td></tr>',t+='<tr id="extraRow1"><td><div class="required"><label for="key_file_upload" class="right">Key File: </label></div></td>',t+='<td><input id="keyfile" name="key_file" type="file" class="required field_associates" /></td>'):t+=a,$("#fileinfo").append(t+""+i),$("#fileinfo .fieldHint").each(function(){setupFieldHint(this)}),$("#extraKeyInfo").slideDown(300)}else $("#extraKeyInfo").length>0&&$("#extraKeyInfo").slideUp(300,function(){$("#extraKeyInfo").remove()})}$(document).ready(function(){$("#drForm").validate({submitHandler:function(e){setupDrFlash(),e.submit()}}),$.validator.addMethod("description",function(e,t){return this.optional(t)||/^[a-zA-Z0-9_'"\,\-\.\?!\(\)\s&%#@\+\:\;~]*$/.test(e)},"Invalid description!"),$.validator.addClassRules("validate-description",{required:!0,minlength:4,description:!0,messages:{required:"Required field!",minlength:"Too short!"}}),toggle_disable($("#store")),checkKeyInfo(),$("#flashMessageBackground")&&$("#flashMessageBackground").hide(),$(".fieldhint").each(function(){setupFieldHint(this)}),$("#key").change(function(){var e=$("#key option:selected");update_key_desc(e.text(),e.val(),"#key_desc")}),$("#submitFormButton").click(function(){$("#generateHistogram").val("0")}),$("#resetButton").click(function(){checkKeyInfo(),toggle_disable($("#store")),$("#generateHistogram").val("0")}),$("#restoreSession").click(function(){setupFlash(!0,"Loading Sessions...");var e=function(){$("#restore_div2").css("overflow","auto"),killFlash()},t=$("#authenticity_token").val();submitAjax({strURL:"/tools/cgi-bin/dr_engine/show_sessions.cgi?at="+encodeURIComponent(t),method:"GET",whatToUpdate:"restore_div",callback:e})}),$("#generateHistogramButton").click(function(){$("#generateHistogram").val("1")}),$("#advanced_options_head").click(function(){showHideDiv($(this))}),$("#result_fake").load(function(){$("#result_fake").contents().find('body:contains("500 error"),title:contains("500")').length>0&&updateFlash("Error running DR Engine. Please try again later or <a style='display:inline;' href='mailto:admin@rothsteinlab.com'>contact the administrator.</a><br/>","ERROR!","flashError")})});