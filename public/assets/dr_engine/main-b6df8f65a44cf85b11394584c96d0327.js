function setupPage(e){if($(".plate td img").on("dragstart",function(e){e.preventDefault()}),$(document).mousedown(function(){MouseDown=!0}).mouseup(function(){MouseDown=!1}),$(".col").mouseenter(function(){MouseDown&&ec(this)}),$(".rowHead, .rowSubHead").click(function(){excludeRow(this)}),$(".col").mousedown(function(){ec(this)}),$("#next_plates, #finalAnalysis").on("submit",function(){return hideStuff(),save_progress("excludeList","killedPlates")}),$("#plate_jump").on("submit",function(){return hideStuff(),updateFlashTitle($(this.parentNode)),save_progress("excludeList2","killedPlates2")}),"4"==replicates?positionsFunction=function(e){return[e,e+1,e+plateRows,e+plateRows+1]}:"2v"==replicates?positionsFunction=function(e){return[e,e+1]}:"2h"==replicates?positionsFunction=function(e){return[e,e+plateRows]}:"16"==replicates?positionsFunction=function(e){return[e,e+1,e+2,e+3,e+plateRows,e+plateRows+1,e+plateRows+2,e+plateRows+3,e+plateRows2,e+plateRows2+1,e+plateRows2+2,e+plateRows2+3,e+plateRows3,e+plateRows3+1,e+plateRows3+2,e+plateRows3+3]}:"1"==replicates&&(positionsFunction=function(e){return[e]}),$("table.plate tbody tr td.rowHead, table.plate tbody tr td.rowSubHead").hover(function(){if($(this).hasClass("rowHead")){for(var e=$(this).prop("rowSpan")||1,l=$(this).closest("tr").next(),t=l,n=1;e-1>n;n++)l=l.next(),t=t.add(l);t.toggleClass("highlight")}$(this).siblings().not($(this).prev()).toggleClass("highlight")}),$("table.plate").each(function(){fixCellIndexes(this)}),$("table.plate thead tr td.colHeader, table.plate thead tr td.colSubHead").hover(function(){var e=this;for(l=0;l<e.colSpan;l++)elementIndex=e.realIndex+l,$(e).closest("tr").nextAll().find(":nth-child("+(elementIndex+1)+")").toggleClass("highlight"),$(e).closest("table").find("tbody>tr>td:nth-child("+elementIndex+")").each(function(){this.realIndex==elementIndex?$(this).toggleClass("highlight"):$(this).next().toggleClass("highlight")})}),$("#layout").fadeIn(),0==parent.$(".flashError").length&&parent.killFlash(),parent.$("#exclusionTableWrapper")&&(parent.setMenuOffset(parent.$("#exclusionTableWrapper")),parent.$("#exclusionTableWrapper").css("display","")),"undefined"!=typeof control)for(var l=0;l<e.length;l++)if(""!=e[l]){var t=e[l].split(/,/);t[2]||(t[2]=""),t[6]||(t[6]=""),plate=$("#"+plateIndicesRev[t[0]+"-"+t[1]+"-"+t[2]]),plate.length>0&&"ce"!=t[6]&&killPlate(plate,t[0],!1),t[0]==control&&plate.length<1&&killPlate(t[0]+"-"+t[1]+"-"+t[2],t[0],!1)}}function removeAllExclusion(e){for(var l=e.find("td.eSingle"),t=0;t<l.length;t++)ec(l[t]);e.find("td.columnExcluded, td.rowExcluded").removeClass("columnExcluded rowExcluded");var n=e.prop("id").replace(/^plate/,"p");parent.$("#"+n+"-li").slideUp(function(){$(this).remove()})}function excludeColumn(e){for($(e).toggleClass("columnExcluded"),i=0;i<e.colSpan;i++){elementIndex=e.realIndex+i;var l=$(e).closest("tr").nextAll().find(":nth-child("+(elementIndex+1)+")"),t=$(e).closest("table").find("tbody>tr>td:nth-child("+elementIndex+")");$(e).hasClass("columnExcluded")?(l.addClass("columnExcluded"),t.each(function(){var e=$(this);this.realIndex!=elementIndex&&(e=e.next()),e.is(".ce, .eSingle")||ec(e)})):(l.removeClass("columnExcluded"),t.each(function(){var e=$(this);this.realIndex!=elementIndex&&(e=e.next()),!e.hasClass(".ce")&&e.hasClass("eSingle")&&ec(e)}))}}function excludeRow(e){e=$(e),e.toggleClass("rowExcluded");var l=e.siblings().not(".rowHead, .rowSubHead, .blankCellRight"),t=$();if(e.hasClass("rowHead")){var n=e.prop("rowSpan")||1,i=e.closest("tr").next(),a=i;t=t.add(i.children(":first")),t=t.add(e.next());for(var s=1;n-1>s;s++)i=i.next(),t=t.add(i.children(":first")),a=a.add(i);l=l.add(a.children().not(".rowHead, .rowSubHead, .blankCellRight"))}e.hasClass("rowExcluded")?(t.addClass("rowExcluded"),l.not(".ce, .eSingle").each(function(){ec($(this))})):(t.removeClass("rowExcluded"),l.filter(".ce, .eSingle").each(function(){ec($(this))}))}function hideStuff(){$("#layout").fadeOut(),parent.$("#exclusionTableWrapper").hide(),$(".excludedPlateContainer").hide()}function save_progress(e,l){var t="";parent.$("#excludeListTable ul li").each(function(){var e=$(this).prop("id").replace(/^li\-/,"").split("-");t=t+"*-*"+plateIndices[e[0]]+","+e[1]});var n="";return parent.$("#KilledPlatesTable")&&(parent.$("#KilledPlatesTable").children().each(function(){var e=$(this).prop("id").replace(/^li\-plate/,"p");n=$(this).hasClass("controlExcluded")?n+plateIndices[e]+",ce*-*":n+plateIndices[e]+"*-*"}),n=n.replace(new RegExp("\\*-\\*$"),"")),e&&$("#"+e).length>0&&$("#"+e).val(t),l&&$("#"+l).length>0&&$("#"+l).val(n),1}function updateFlashTitle(e){if(e.length<1)return!1;var l="Generating Cartoon Renderings...";return $("#next_page_num option:selected").val().match(/^analysis/i)&&(l="Performing Final Analysis..."),parent.setupFlash(!0,l),!0}function cs(e){var l=0,t=e.prop("id").split("-"),n=parseInt(t[t.length-1]),i=parseInt(t[t.length-2]);t=t.slice(0,-2).join("-");for(var a=positionsFunction(n),s=0;s<a.length;s++)l+=$("#"+t+"-"+a[s]+"-"+n+".eSingle").length;return{orig:e.prop("id"),positions:a,origPosition:i,count:l}}function ce(e){for(var l=0;l<queries.length;l++){var t=e.orig.split("-"),n=plateIndicesRev[plateIndices[t[0]].replace(new RegExp(control,"gi"),queries[l])];if(n&&n!=t[0])if(e.count==numReps)for(var i=0;i<e.positions.length;i++)$("#"+n+"-"+e.positions[i]+"-"+e.positions[0]).addClass("ce");else for(var i=0;i<e.positions.length;i++)$("#"+n+"-"+e.positions[i]+"-"+e.positions[0]).removeClass("ce")}}function ec(e){var l=$(e);if($(l).prop("id")){var t=l.prop("id").split("-"),n=t[0],i=!1;if(0==plateIndices[n].toLowerCase().indexOf(control)&&(i=!0),l.is(".eSingle, .excludedCol, .excludedRow, .ce, .blankCellRight")){if(l.removeClass("eSingle excludedCol excludedRow"),i){var a=cs(l);a.count==numReps-1&&ce(a)}parent.$("#li-"+n+"-"+t[t.length-2]).slideUp(function(){$(this).remove(),parent.$("#"+n+"-ul").length>0&&parent.$("#"+n+"-ul").children().length<1&&parent.$("#"+n+"-li").slideUp(function(){$(this).remove()})})}else{if(l.addClass("eSingle"),i){var a=cs(l);a.count==numReps&&ce(a)}var s=plateIndices[n].replace(/, $/,"").replace(/,$/,"");if(parent.$("#"+n+"-li").length<1){var o='<li id="'+n+'-li">';o+='<div class="el_showHide" onclick="$(this).toggleClass(\'showUL\'); $(this).next().slideToggle();">'+s+"</div>",o+='<ul id="'+n+'-ul" class="excludedElementList" style="display:none;"></ul></li>',parent.$("#excludeListTable").append(o)}var r='<li id="li-'+n+"-"+t[t.length-2]+'">';r+='<a href="#'+escape(n)+'">'+s+" -- "+l.prop("title")+"</a></li>",parent.$("#"+n+"-ul").append(r)}}}function killPlate(e,l,t){var n=$(),i=e.prop("id"),a=i+"exclusionDIV";if(n=$("#"+a),t&&(n.hide(),parent.$("#li-"+i).hide(),a=a+"-"+l,n=$("#"+a),i=i+"-"+l),n.length<1){var s=e.outerWidth(),o=e.outerHeight(),r="position:absolute;height:"+o+";width:"+s+";top:"+e.offset().top+";left:"+e.offset()+";",c='<div id="'+a+'" class="excludedPlateContainer" style="'+r+'">',d=o/2-85,p="<div onclick=\"restorePlate('"+a+"', '"+l+'\');" class="excludedPlate" style="margin-top:'+d+'px;"><h2 onclick="restorePlate(\''+a+"', '"+l+"');\">This plate has been excluded from statistical consideration click on this window to re-include it</h2></div>";t&&(p='<div class="excludedPlate" style="margin-top:'+d+'px;"><h2>The comparer plate corresponding to this experimental plate has been excluded from statistical consideration. The corresponding comparer plate must be re-included into statisitcal consideration before this plate can be re-included.</h2></div>'),$("#screen_mill_dr_engine").append(c+p+"</div>");var u="li-"+i,h='<li id="'+u+'"><a href="#'+escape(i)+'">';if(h+=e.find(".plateTitle .middle a").html()+"</a></li>",parent.$("#KilledPlatesTable").length<1){parent.$("#coloniesDIV").css("height","200px");var f='<hr id = "exclusionHR" /><u class="title" id="ePlatesTitle">Plates</u>';f+='<div class="plates" id="ePlatesDiv"><ul id="KilledPlatesTable" class="list"></ul></div>',parent.$("#exclusionTableWrapper").append(f)}parent.$("#KilledPlatesTable").append(h)}if(l==control)for(var g=e.prop("id").replace(/^plate/i,"p"),v=plateIndices[g],x=0;x<queries.length;x++)if(queries[x]!=control){var C=plateIndicesRev[v.replace(control,queries[x])];C&&(C=C.replace(/^p/i,"plate"),$("#"+C).length>0&&killPlate($("#"+C),e.prop("id"),!0))}}function restorePlate(e,l){var t=$("#"+e);t.length>0&&t.remove();var n=e.replace("exclusionDIV","");if(t=parent.$("#li-"+n),t.length>0&&t.remove(),l==control)for(var i,a=0;a<queries.length;a++)if(queries[a]!=control){var i=plateIndicesRev[plateIndices[n.replace(/^plate/i,"p")].replace(control,queries[a])];i&&(i=i.replace(/^p/i,"plate"),i+="exclusionDIV",t=$("#"+i),t.length>0&&(t.show(),t=parent.$("#li-"+i.replace("exclusionDIV","")),t.length>0&&(t[0].style.display="")),i=i+"-"+n,$("#"+i.length>0)&&restorePlate(i,"ControlExcluded"))}parent.$("#KilledPlatesTable").length>0&&parent.$("#KilledPlatesTable").children().length<1&&(parent.$("#exclusionHR").remove(),parent.$("#ePlatesTitle").remove(),parent.$("#ePlatesDiv").remove(),parent.$("#coloniesDIV").css("height","300px"))}alphabet=new Array("A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","AA","AB","AC","AD","AE","AF","AG","AH","AI","AJ","AK","AL","AM","AN","AO","AP","AQ","AR","AS","AT","AU","AV","AW","AX","AY","AZ","BA","BB","BC","BD","BE","BF","BG","BH","BI","BJ","BK","BL","BM","BN","BO","BP","BQ","BR","BS","BT","BU","BV","BW","BX","BY","BZ","CA","CB","CC","CD","CE","CF","CG","CH","CI","CJ","CK","CL","CM","CN","CO","CP","CQ","CR","CS","CT","CU","CV","CW"),doNotDisplayClass="displayNone";var positionsFunction=function(){return[]},MouseDown=!1,fixCellIndexes=function(e){for(var l=e.rows,t=l.length,n=[],i=0;t>i;i++)for(var a=l[i].cells,s=a.length,o=0;s>o;o++){var r=a[o],c=r.rowSpan||1,d=r.colSpan||1,p=-1;n[i]||(n[i]=[]);for(var u=n[i];u[++p];);r.realIndex=p;for(var h=i;i+c>h;h++){n[h]||(n[h]=[]);for(var f=n[h],g=p;p+d>g;g++)f[g]=1}}};